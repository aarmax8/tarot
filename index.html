<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Essential Oracle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@900&family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --gold-bright: #fceea7;
            --stadium-blue: #020617;
            --border: rgba(212, 175, 55, 0.4);
        }

        body {
            background-color: var(--stadium-blue);
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 50% 0%, #1e293b 0%, transparent 70%),
                linear-gradient(to bottom, #020617, #000);
        }

        .cinzel { font-family: 'Cinzel', serif; }

        /* Card Flip Mechanics */
        .card-container {
            perspective: 1500px;
            aspect-ratio: 2 / 3.5;
            width: 100%;
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
        }

        .card-container.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            border: 2.2px solid var(--gold);
            box-shadow: 0 15px 40px rgba(0,0,0,0.9);
            overflow: hidden;
        }

        .card-back {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-front {
            background: #000;
            transform: rotateY(180deg);
            z-index: 1;
        }

        /* Fixed Orientation Layer to ensure reversed cards display art correctly */
        .orientation-layer {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .is-reversed { transform: rotate(180deg); }

        .outcome-glass {
            background: rgba(15, 23, 42, 0.94);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }

        .loader {
            width: 44px;
            height: 44px;
            border: 3px solid rgba(255,255,255,0.1);
            border-bottom-color: var(--gold);
            border-radius: 50%;
            display: inline-block;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .shimmer {
            background: linear-gradient(90deg, #0f172a 25%, #1e293b 50%, #0f172a 75%);
            background-size: 200% 100%;
            animation: shimmerMove 1.5s infinite;
        }
        @keyframes shimmerMove { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        .hidden { display: none !important; }
    </style>
</head>
<body class="min-h-screen pb-44">

    <!-- Header -->
    <header class="fixed top-0 w-full z-50 px-6 py-8 bg-slate-950/90 backdrop-blur-md border-b border-amber-900/30 text-center">
        <h1 class="cinzel text-lg font-black tracking-[0.4em] text-amber-500 uppercase">The Essential Oracle</h1>
    </header>

    <!-- Navigation -->
    <nav class="fixed bottom-0 w-full z-50 px-8 py-10 bg-slate-950/95 backdrop-blur-xl border-t border-amber-900/30 flex justify-around items-center">
        <button onclick="app.nav('home')" class="flex flex-col items-center gap-1 text-slate-400 hover:text-amber-500 transition-colors">
            <span class="text-2xl font-bold">‚óã</span>
            <span class="text-[9px] uppercase tracking-[0.2em] font-black">Preparation</span>
        </button>
        <button onclick="app.nav('reading')" class="flex flex-col items-center gap-1 text-slate-400 hover:text-amber-500 transition-colors">
            <span class="text-2xl font-bold">‚éî</span>
            <span class="text-[9px] uppercase tracking-[0.2em] font-black">Insights</span>
        </button>
        <button onclick="app.nav('deck')" class="flex flex-col items-center gap-1 text-slate-400 hover:text-amber-500 transition-colors">
            <span class="text-2xl font-bold">‚ñ°</span>
            <span class="text-[9px] uppercase tracking-[0.2em] font-black">The Vault</span>
        </button>
    </nav>

    <!-- Main Views -->
    <main class="pt-36 px-6 max-w-4xl mx-auto">
        
        <!-- View: Home -->
        <div id="view-home" class="view space-y-12 text-center animate-in fade-in duration-700">
            <div class="py-4">
                <span class="text-7xl block mb-6 drop-shadow-[0_0_20px_rgba(212,175,55,0.4)]">‚ùÇ</span>
                <h2 class="cinzel text-4xl font-black tracking-widest text-white uppercase leading-tight">Your <br/>Living Path</h2>
            </div>
            
            <div class="max-w-xs mx-auto space-y-4">
                <label class="text-[10px] tracking-[0.3em] text-slate-500 uppercase font-black text-center block">Declare Presence</label>
                <select id="zodiac-input" class="w-full bg-slate-900 border border-amber-900/40 rounded-lg p-4 text-center text-white font-bold focus:outline-none focus:border-amber-500 appearance-none cursor-pointer">
                    <option value="Universal" selected>Universal Presence</option>
                    <option value="Aries">Aries</option><option value="Taurus">Taurus</option>
                    <option value="Gemini">Gemini</option><option value="Cancer">Cancer</option>
                    <option value="Leo">Leo</option><option value="Virgo">Virgo</option>
                    <option value="Libra">Libra</option><option value="Scorpio">Scorpio</option>
                    <option value="Sagittarius">Sagittarius</option><option value="Capricorn">Capricorn</option>
                    <option value="Aquarius">Aquarius</option><option value="Pisces">Pisces</option>
                </select>
            </div>

            <p class="text-slate-400 italic text-lg leading-relaxed px-4 max-w-md mx-auto">
                "Life is a journey of constant movement. Align your Mind, Body, and Soul to find your rhythm for the day ahead."
            </p>

            <button onclick="app.draw()" class="w-full py-6 rounded-md cinzel font-black uppercase tracking-[0.3em] text-amber-500 border-2 border-amber-500 hover:bg-amber-500 hover:text-black transition-all shadow-[0_0_25px_rgba(212,175,55,0.2)]">
                Seek New Alignment
            </button>
        </div>

        <!-- View: Reading -->
        <div id="view-reading" class="view hidden space-y-12">
            <div id="spread-container" class="grid grid-cols-3 gap-3 sm:gap-6 items-start"></div>

            <div id="loading-indicator" class="hidden flex flex-col items-center justify-center space-y-4 py-10">
                <span class="loader"></span>
                <p class="cinzel text-[10px] tracking-[0.4em] text-amber-500 animate-pulse uppercase font-black">Consulting the Oracle...</p>
            </div>

            <div id="outcome-container" class="hidden animate-in fade-in slide-in-from-bottom-10 duration-1000 pb-10"></div>
            
            <div id="reset-button-container" class="hidden text-center">
                <button onclick="app.draw()" class="text-amber-500 uppercase tracking-widest font-black text-[10px] border border-amber-500 px-8 py-3 rounded-md hover:bg-amber-500 hover:text-black transition-all shadow-lg">
                    Reset Spread
                </button>
            </div>
        </div>

        <!-- View: Deck / Roster -->
        <div id="view-deck" class="view hidden">
            <h2 class="cinzel text-xl text-amber-500 mb-8 tracking-[0.4em] text-center font-black uppercase">The Vault</h2>
            <p class="text-slate-500 text-[10px] uppercase text-center mb-8 tracking-widest italic">Flip a card to reveal its life wisdom</p>
            <div id="deck-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6 pb-24"></div>
        </div>
    </main>

    <script>
        const apiKey = ""; 

        const MAJOR_ARCANA = [
            { id: 0, num: "0", name: "The Fool", prompt: "Highly detailed athletic tarot card. A rookie athlete silhouetted in a dark stadium tunnel looking out at a bright arena, cinematic lighting, gold border", u: "A new start in life. Have the courage to take a risk and trust your training. The day is wide open for you.", r: "You're rushing into a commitment. Slow down and scout the day ahead before you make your first move." },
            { id: 1, num: "I", name: "The Magician", prompt: "Highly detailed athletic tarot card. Star player orchestrating a play with glowing tactical holographic lines, focus, gold helmet", u: "You possess all the tools to manifest success today. Execute your plan with absolute confidence.", r: "Scattered focus. You're trying to do too many things at once; pick one goal for today and put your power behind it." },
            { id: 2, num: "II", name: "High Priestess", prompt: "Highly detailed athletic tarot card. Female athlete meditating in a zen dark room with neon blue lines, lunar cycle", u: "Trust your internal voice. Today's clarity will come from a place of quiet focus, not the noise of others.", r: "Ignoring your gut. You are listening to the crowd too much. Tune out the noise and trust what you feel." },
            { id: 3, num: "III", name: "The Empress", prompt: "Highly detailed athletic tarot card. Team owner in a luxury box overlooking a lush green field, abundance", u: "A day of growth and abundance. Your hard work is finally yielding a deep, nurturing reward in your personal life.", r: "Creative stagnation. You're feeling uninspired; go back to basics to find your internal flow today." },
            { id: 4, num: "IV", name: "The Emperor", prompt: "Highly detailed athletic tarot card. Head coach with a glowing championship ring, authority, structural geometry", u: "Strategy and discipline are your winning moves today. Be the leader of your own journey.", r: "Rigid thinking. You are trying to control variables you can't. Adapt to the circumstances as they unfold." },
            { id: 10, num: "X", name: "Wheel of Fortune", prompt: "Highly detailed athletic tarot card. Massive mechanical clockwork ring in a stadium, destiny", u: "The tides of your life are turning. A lucky break or a positive shift in momentum is manifesting today.", r: "Resisting change. You're fighting the natural flow of life's seasons. Adapt and go with the cycle." },
            { id: 13, num: "XIII", name: "Death", prompt: "Highly detailed athletic tarot card. Final whistle. Stadium lights dimming on empty field, single gold whistle on turf", u: "A cycle is concluding. Let the past go so you can prepare for a fresh chapter starting tomorrow.", r: "Clinging to a loss. The time has run out on this situation; accept it and start prepping for the next game." },
            { id: 16, num: "XVI", name: "The Tower", prompt: "Highly detailed athletic tarot card. Stadium scoreboard exploding, sparks, sudden upset", u: "A sudden realization breaks a false belief. It's a messy but needed reset for your inner foundations.", r: "Avoiding a needed change. You see the collapse coming; face it now to save your energy for the rebuild." },
            { id: 19, num: "XIX", name: "The Sun", prompt: "Highly detailed athletic tarot card. Athlete holding trophy high under floodlights, confetti, success", u: "Championship energy! Your path is clear and success is yours today. Celebrate your achievements.", r: "Temporary clouding. The success is there, but you're second-guessing it. You earned this; don't let doubt win." }
        ];

        const SUITS = ["Wands", "Cups", "Swords", "Pentacles"];
        const RANKS = ["Ace", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten", "Page", "Knight", "Queen", "King"];
        const FULL_DECK = [...MAJOR_ARCANA];
        SUITS.forEach((suit, sIdx) => {
            const focus = suit === "Wands" ? "drive" : suit === "Cups" ? "heart" : suit === "Swords" ? "logic" : "finances";
            const sport = suit === "Wands" ? "Sprint" : suit === "Cups" ? "Swimming" : suit === "Swords" ? "Fencing" : "Shotput";
            const meaning = suit === "Wands" ? "passion and creative fire" : suit === "Cups" ? "emotional connections" : suit === "Swords" ? "mental clarity and truth" : "material security and physical health";
            
            RANKS.forEach((rank, rIdx) => {
                FULL_DECK.push({
                    id: 100 + (sIdx * 14) + rIdx,
                    num: rank,
                    name: `${rank} of ${suit}`,
                    prompt: `Highly detailed athletic tarot card. Athlete doing ${sport} with ${suit} symbols, gold border, cinematic lighting`,
                    u: `Today highlights your ${focus}. Expect progress and a sense of mastery regarding your ${meaning}.`,
                    r: `You're feeling blocked regarding your ${focus}. Take a timeout today to rest and re-evaluate your ${meaning}.`
                });
            });
        });

        const SIGILS = { "Fire": "‚ñ≥", "Water": "‚àá", "Air": "üúÅ", "Earth": "üúÉ" };
        const Z_EL = { "Aries":"Fire","Leo":"Fire","Sagittarius":"Fire","Taurus":"Earth","Virgo":"Earth","Capricorn":"Earth","Gemini":"Air","Libra":"Air","Aquarius":"Air","Cancer":"Water","Scorpio":"Water","Pisces":"Water" };

        const app = {
            spread: [],
            images: {},
            selectedZodiac: "Universal",

            nav(id) {
                document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
                const viewEl = document.getElementById('view-' + id);
                if (viewEl) viewEl.classList.remove('hidden');
                if (id === 'deck') this.renderDeck();
            },

            async draw() {
                const zodiacEl = document.getElementById('zodiac-input');
                this.selectedZodiac = zodiacEl ? zodiacEl.value : "Universal";
                
                this.nav('reading');
                const container = document.getElementById('spread-container');
                const outcome = document.getElementById('outcome-container');
                const loader = document.getElementById('loading-indicator');
                const resetBtn = document.getElementById('reset-button-container');
                
                container.innerHTML = '';
                outcome.classList.add('hidden');
                resetBtn.classList.add('hidden');
                loader.classList.remove('hidden');

                const pool = [...FULL_DECK];
                this.spread = [];
                for(let i=0; i<3; i++) {
                    const idx = Math.floor(Math.random() * pool.length);
                    const card = {...pool.splice(idx, 1)[0], isRev: Math.random() > 0.6, aspect: ['Mind', 'Body', 'Soul'][i], element: ['Air','Fire','Water'][i]};
                    this.spread.push(card);
                    this.renderCardSkeleton(card, i);
                }

                await Promise.all(this.spread.map(async (c, i) => {
                    const img = await this.generateImage(c.prompt);
                    this.images[c.id] = img;
                    this.updateCard(c, i, img);
                }));

                loader.classList.add('hidden');
                resetBtn.classList.remove('hidden');
            },

            async generateImage(prompt) {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;
                const payload = { instances: [{ prompt }], parameters: { sampleCount: 1 } };
                try {
                    let retry = 0;
                    while (retry < 5) {
                        const response = await fetch(url, { method: 'POST', body: JSON.stringify(payload) });
                        const data = await response.json();
                        if (data.predictions?.[0]?.bytesBase64Encoded) {
                            return `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
                        }
                        await new Promise(r => setTimeout(r, 1000 * Math.pow(2, retry)));
                        retry++;
                    }
                } catch (e) {}
                return null;
            },

            renderCardSkeleton(card, i) {
                const html = `
                    <div class="flex flex-col items-center gap-4">
                        <span class="cinzel text-[10px] tracking-[0.4em] text-slate-500 font-black uppercase">${card.aspect}</span>
                        <div id="card-wrap-${i}" class="card-container" onclick="app.flipCard(this, ${i})">
                            <div class="card-inner">
                                <div class="card-back">
                                    <div class="w-full h-full border border-amber-500/20 m-1 flex items-center justify-center">
                                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="0.8">
                                            <circle cx="12" cy="12" r="8" stroke-dasharray="1 1" opacity="0.3" />
                                            <circle cx="12" cy="12" r="4" stroke="var(--gold)" />
                                        </svg>
                                    </div>
                                </div>
                                <div id="card-front-${i}" class="card-front">
                                    <div class="w-full h-full shimmer"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('spread-container').insertAdjacentHTML('beforeend', html);
            },

            updateCard(card, i, imgSrc) {
                const el = document.getElementById(`card-front-${i}`);
                if (!el) return;
                el.innerHTML = `
                    <div class="orientation-layer ${card.isRev ? 'is-reversed' : ''}">
                        <div class="relative w-full h-full">
                            <img src="${imgSrc || 'https://via.placeholder.com/400x600/000/000?text=Wait+for+Signal'}" class="w-full h-full object-cover">
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-60"></div>
                            
                            <!-- Header Bar -->
                            <div class="absolute top-0 w-full bg-black/60 backdrop-blur-md border-b border-amber-500/20 py-2 px-3 flex justify-between items-center z-30">
                                <div class="w-7 h-7 rounded-full border border-amber-400 bg-black/60 flex items-center justify-center">
                                    <span class="cinzel text-[10px] font-black text-amber-200">${card.num}</span>
                                </div>
                                <span class="cinzel font-black text-amber-200 text-sm drop-shadow-lg">${SIGILS[card.element] || '‚úß'}</span>
                            </div>
                            
                            <!-- Bottom Title Bar -->
                            <div class="absolute bottom-4 left-2 right-2 bg-black/90 border border-amber-500/40 py-2 text-center backdrop-blur-sm z-20 rounded">
                                <h3 class="cinzel text-[9px] font-black text-amber-400 tracking-[0.2em] uppercase truncate">${card.name}</h3>
                            </div>
                        </div>
                    </div>
                `;
            },

            flipCard(el, i) {
                el.classList.add('flipped');
                const allFlipped = document.querySelectorAll('.card-container.flipped').length;
                if (allFlipped === 3) setTimeout(() => this.synthesize(), 800);
            },

            synthesize() {
                const userEl = Z_EL[this.selectedZodiac] || "Grit";
                const [mind, body, soul] = this.spread;

                let narrative = `
                    <div class="space-y-6">
                        <p class="text-xl italic leading-relaxed text-slate-200 border-b border-amber-900/30 pb-4">
                            "The alignment for your day is set. Reflect on these pillars of your journey."
                        </p>
                        <div class="space-y-6 text-slate-300">
                            <p><span class="text-amber-500 font-black uppercase text-[11px] tracking-widest block mb-1">Your Mind (Cognitive Strategy):</span> 
                               With <strong>${mind.name}</strong> leading your thoughts, your mindset today is ${mind.isRev ? mind.r.toLowerCase() : mind.u.toLowerCase()}</p>
                            
                            <p><span class="text-amber-500 font-black uppercase text-[11px] tracking-widest block mb-1">Your Body (Active Energy):</span> 
                               <strong>${body.name}</strong> shows that your physical path today is ${body.isRev ? body.r.toLowerCase() : body.u.toLowerCase()}</p>
                            
                            <p><span class="text-amber-500 font-black uppercase text-[11px] tracking-widest block mb-1">Your Soul (Deep Alignment):</span> 
                               <strong>${soul.name}</strong> whispers that your core spirit for today is ${soul.isRev ? soul.r.toLowerCase() : soul.u.toLowerCase()}</p>
                        </div>
                    </div>
                `;

                const colors = { "Fire": ["Vitality Red", "#dc2626"], "Water": ["Calm Indigo", "#3b82f6"], "Air": ["Focus Silver", "#f8fafc"], "Earth": ["Foundational Gold", "#d4af37"], "Grit": ["Obsidian Shadow", "#1e293b"] };
                const lucky = colors[userEl];

                const out = document.getElementById('outcome-container');
                out.innerHTML = `
                    <div class="outcome-glass p-8 rounded-xl space-y-8 border border-amber-500/30">
                        <span class="cinzel text-[10px] tracking-[0.6em] text-amber-500 font-black block text-center uppercase">Daily Synthesis</span>
                        <div class="outcome-text">${narrative}</div>
                        <div class="flex items-center gap-6 p-4 bg-black/40 rounded-lg border border-white/5">
                            <div class="w-14 h-14 rounded-full border-2 border-white shadow-lg" style="background:${lucky[1]}; box-shadow: 0 0 30px ${lucky[1]}"></div>
                            <div>
                                <span class="cinzel text-[10px] tracking-widest text-slate-500 block uppercase font-black">Spirit Hue</span>
                                <span class="text-white font-black text-xl uppercase tracking-widest">${lucky[0]}</span>
                            </div>
                        </div>
                    </div>
                `;
                out.classList.remove('hidden');
                out.scrollIntoView({ behavior: 'smooth' });
            },

            renderDeck() {
                const grid = document.getElementById('deck-grid');
                grid.innerHTML = FULL_DECK.map(c => `
                    <div class="card-container" onclick="this.classList.toggle('flipped')">
                        <div class="card-inner">
                            <div class="card-front">
                                <div class="relative w-full h-full">
                                    <img src="${this.images[c.id] || 'https://via.placeholder.com/400x600/020617/d4af37?text=Scouting...'}" class="w-full h-full object-cover">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                                    <div class="absolute top-2 left-2 w-7 h-7 rounded-full border border-amber-500 flex items-center justify-center bg-black/40">
                                        <span class="cinzel text-[10px] font-black text-amber-200">${c.num}</span>
                                    </div>
                                    <div class="absolute bottom-3 w-full text-center">
                                        <span class="cinzel text-[8px] font-black text-amber-400 tracking-widest uppercase truncate px-1">${c.name}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-back">
                                <div class="p-6 text-center flex flex-col items-center justify-center h-full">
                                    <span class="cinzel text-[13px] text-amber-500 font-black uppercase mb-4 block border-b border-amber-900/40 pb-2 w-full">${c.name}</span>
                                    <p class="text-[13px] text-slate-200 italic font-medium leading-relaxed">${c.u}</p>
                                    <div class="mt-8 opacity-10">
                                        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="1">
                                            <circle cx="12" cy="12" r="8" stroke-dasharray="1 1" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        };

        window.addEventListener('DOMContentLoaded', () => {
            app.draw();
        });
    </script>
</body>
</html>
