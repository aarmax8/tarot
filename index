<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystic Oracle Tarot</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel for browser compilation -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600&family=Inter:wght@400;600&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; margin: 0; }
        .font-serif { font-family: 'Crimson Pro', serif; }
        
        /* Perspective for card flips */
        .perspective-1000 { perspective: 1000px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; -webkit-backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes bounce-subtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce-subtle { animation: bounce-subtle 3s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- IMPORTANT: REPLACE THESE WITH YOUR KEYS ---
        const myFirebaseConfig = {
            apiKey: "YOUR_FIREBASE_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        const GEMINI_API_KEY = "YOUR_GOOGLE_AI_STUDIO_API_KEY";
        // -----------------------------------------------

        // Fallback for environment variables (Canvas compatibility)
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : myFirebaseConfig;
        const apiKey = typeof __api_key !== 'undefined' ? __api_key : GEMINI_API_KEY;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'mystic-tarot-personal';

        const TAROT_DECK = [
            "The Fool", "The Magician", "The High Priestess", "The Empress", "The Emperor", "The Hierophant", "The Lovers", "The Chariot", "Strength", "The Hermit", "Wheel of Fortune", "Justice", "The Hanged Man", "Death", "Temperance", "The Devil", "The Tower", "The Star", "The Moon", "The Sun", "Judgement", "The World",
            "Ace of Cups", "Two of Cups", "Three of Cups", "Four of Cups", "Five of Cups", "Six of Cups", "Seven of Cups", "Eight of Cups", "Nine of Cups", "Ten of Cups", "Page of Cups", "Knight of Cups", "Queen of Cups", "King of Cups",
            "Ace of Pentacles", "Two of Pentacles", "Three of Pentacles", "Four of Pentacles", "Five of Pentacles", "Six of Pentacles", "Seven of Pentacles", "Eight of Pentacles", "Nine of Pentacles", "Ten of Pentacles", "Page of Pentacles", "Knight of Pentacles", "Queen of Pentacles", "King of Pentacles",
            "Ace of Swords", "Two of Swords", "Three of Swords", "Four of Swords", "Five of Swords", "Six of Swords", "Seven of Swords", "Eight of Swords", "Nine of Swords", "Ten of Swords", "Page of Swords", "Knight of Swords", "Queen of Swords", "King of Swords",
            "Ace of Wands", "Two of Wands", "Three of Wands", "Four of Wands", "Five of Wands", "Six of Wands", "Seven of Wands", "Eight of Wands", "Nine of Wands", "Ten of Wands", "Page of Wands", "Knight of Wands", "Queen of Wands", "King of Wands"
        ];

        // Custom Icon Component using Inline SVGs for reliability
        const Icon = ({ name, className }) => {
            const icons = {
                Moon: (
                    <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                    </svg>
                ),
                Sun: (
                    <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/>
                    </svg>
                ),
                Sparkles: (
                    <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/>
                    </svg>
                ),
                ChevronLeft: (
                    <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="m15 18-6-6 6-6"/>
                    </svg>
                ),
                BookOpen: (
                    <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                    </svg>
                ),
                Loader2: (
                    <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                    </svg>
                )
            };
            return icons[name] || null;
        };

        const App = () => {
            const [view, setView] = useState('home');
            const [drawnCards, setDrawnCards] = useState([]);
            const [reading, setReading] = useState(null);
            const [isGenerating, setIsGenerating] = useState(false);
            const [revealedCount, setRevealedCount] = useState(0);

            const handleDrawCards = () => {
                const shuffled = [...TAROT_DECK].sort(() => 0.5 - Math.random());
                const selected = shuffled.slice(0, 3).map(name => ({
                    name,
                    isReversed: Math.random() > 0.5,
                    revealed: false
                }));
                setDrawnCards(selected);
                setRevealedCount(0);
                setReading(null);
                setView('draw');
            };

            const revealCard = (index) => {
                if (drawnCards[index].revealed) return;
                const newCards = [...drawnCards];
                newCards[index].revealed = true;
                setDrawnCards(newCards);
                setRevealedCount(prev => prev + 1);
            };

            const generateReading = async () => {
                if (!apiKey || apiKey.includes("YOUR_")) {
                    setReading("Missing API Key. Please add your Google AI Studio key to the code.");
                    return;
                }
                setIsGenerating(true);
                const cardNames = drawnCards.map(c => `${c.name}${c.isReversed ? ' (Reversed)' : ''}`).join(', ');
                const prompt = `Interpret these tarot cards for growth: ${cardNames}. Provide 3 short paragraphs. Be mystical yet encouraging.`;

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await res.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    setReading(text || "The stars are silent. Try again.");
                } catch (e) {
                    setReading("Connection to the cosmos failed. Check your API key.");
                } finally {
                    setIsGenerating(false);
                }
            };

            const LandingView = () => (
                <div className="flex flex-col items-center justify-center min-h-screen p-6 text-center">
                    <div className="mb-8 p-6 rounded-full bg-indigo-500/10 border border-indigo-500/20 shadow-xl">
                        <Icon name="Moon" className="w-16 h-16 text-indigo-400 animate-pulse" />
                    </div>
                    <h1 className="text-4xl font-serif mb-2">Mystic Oracle</h1>
                    <p className="text-slate-400 mb-12 max-w-xs">A personal gateway to your inner wisdom.</p>
                    <button onClick={handleDrawCards} className="w-full max-w-xs py-4 bg-indigo-600 rounded-2xl font-semibold shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-all">
                        <Icon name="Sparkles" className="w-5 h-5 text-indigo-200" /> Draw Cards
                    </button>
                </div>
            );

            const DrawView = () => (
                <div className="min-h-screen p-6 pt-12 pb-24">
                    <button onClick={() => setView('home')} className="mb-8 flex items-center text-slate-400 gap-1 active:opacity-50">
                        <Icon name="ChevronLeft" className="w-5 h-5" /> Back
                    </button>
                    
                    <div className="flex flex-col gap-6 items-center">
                        {drawnCards.map((card, idx) => (
                            <div key={idx} onClick={() => revealCard(idx)} className="relative w-full max-w-[280px] h-44 cursor-pointer perspective-1000">
                                <div className={`relative w-full h-full transition-all duration-700 preserve-3d ${card.revealed ? '[transform:rotateY(180deg)]' : ''}`}>
                                    {/* Card Back */}
                                    <div className="absolute inset-0 bg-slate-900 border-2 border-indigo-900/50 rounded-2xl flex items-center justify-center backface-hidden shadow-xl">
                                        <Icon name="Moon" className="w-12 h-12 text-indigo-500/20" />
                                    </div>
                                    {/* Card Front */}
                                    <div className="absolute inset-0 bg-slate-800 border-2 border-amber-500/30 rounded-2xl p-4 flex flex-col items-center justify-center backface-hidden [transform:rotateY(180deg)] shadow-xl">
                                        <div className={card.isReversed ? 'rotate-180' : ''}>
                                            <Icon name="Sun" className="w-8 h-8 text-amber-400 mb-2" />
                                            <div className="text-lg font-serif text-amber-100 text-center leading-tight">{card.name}</div>
                                            {card.isReversed && <div className="text-[10px] text-amber-500/60 uppercase tracking-widest text-center mt-1">Reversed</div>}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {revealedCount === 3 && (
                        <div className="mt-12 w-full max-w-md mx-auto">
                            {!reading ? (
                                <button onClick={generateReading} disabled={isGenerating} className="w-full py-4 bg-amber-600 rounded-full font-bold flex items-center justify-center gap-2 animate-bounce-subtle shadow-lg shadow-amber-900/20">
                                    {isGenerating ? <Icon name="Loader2" className="w-5 h-5 animate-spin" /> : <Icon name="Sparkles" className="w-5 h-5" />}
                                    Consult the Oracle
                                </button>
                            ) : (
                                <div className="bg-slate-900/50 p-6 rounded-3xl border border-slate-800 backdrop-blur-sm">
                                    <h3 className="text-amber-400 font-serif mb-4 flex items-center gap-2"><Icon name="BookOpen" className="w-5 h-5" /> Insight</h3>
                                    <div className="text-slate-300 text-sm leading-relaxed whitespace-pre-wrap italic">
                                        {reading}
                                    </div>
                                    <button onClick={handleDrawCards} className="mt-8 w-full py-2 text-slate-500 text-[10px] uppercase tracking-[0.2em] border-t border-slate-800 pt-4 active:text-slate-300">Start New Journey</button>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );

            return (
                <div className="max-w-md mx-auto min-h-screen bg-slate-950 overflow-x-hidden">
                    {view === 'home' ? <LandingView /> : <DrawView />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
